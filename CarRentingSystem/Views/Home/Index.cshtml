@model IEnumerable<ShipmentIndexServiceModel>
@inject IDriverService driverService

@{
    ViewData["Title"] = "Home Page";
    var shipments = Model?.ToList() ?? new List<ShipmentIndexServiceModel>();
}

@if (!shipments.Any())
{
    <div class="mt-4 p-5" style="background-color:#09223c;color:#ffd500;">
        <h1 class="display-4">Welcome to the best place for renting car!</h1>
        <p class="lead">
            There are no cars or routes in the system currently available
            so why don't you just add one?
        </p>
        <hr class="my-4" />
        <p class="lead">
            @if (User?.Identity?.IsAuthenticated == true)
            {
                <a asp-controller="Shipments"
                   asp-action="Add"
                   class="btn btn-primary"
                   role="button"
                   style="background-color:#09223c;color:#ffd500;">
                    Add Shipment
                </a>
            }
        </p>
    </div>
}

<div class="mb-5" style="background-color:#09223c;color:#ffd500;"></div>
<hr />

@if (shipments.Any())
{
    <div id="carouselExampleControls"
         class="carousel slide"
         data-bs-ride="carousel"
         style="background-color:#09223c;color:#ffd500;">
        <div class="carousel-inner">
            @for (int i = 0; i < shipments.Count; i++)
            {
                var shipment = shipments[i];
                <div class="carousel-item @(i == 0 ? "active" : "")">
                    <img class="d-block w-100"
                         style="height:500px;"
                         src="@shipment.ImageUrlShipmentGoogleMaps"
                         alt="@shipment.Title" />
                    <div class="carousel-caption d-none d-md-block">
                        <h5>
                            <a class="btn btn-primary"
                               asp-controller="Shipments"
                               asp-action="Details"
                               asp-route-id="@shipment.ShipmentId"
                               asp-route-information="@shipment.GetInformation()"
                               style="background-color:#09223c;color:#ffd500;">
                                @shipment.Title
                            </a>
                        </h5>
                    </div>
                </div>
            }
        </div>

        <button class="carousel-control-prev"
                type="button"
                data-bs-target="#carouselExampleControls"
                data-bs-slide="prev"
                style="background-color:#09223c;color:#ffd500;">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>

        <button class="carousel-control-next"
                type="button"
                data-bs-target="#carouselExampleControls"
                data-bs-slide="next"
                style="background-color:#09223c;color:#ffd500;">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
}

<div class="mb-5" style="background-color:#09223c;color:#ffd500;"></div>

<div class="row" style="background-color:#09223c;color:#ffd500;">
    <div class="col-12 text-center">
        <button class="btn btn-primary" id="statistics-button" style="background-color:#09223c;color:#ffd500;">
            Show Statistics
        </button>
    </div>
</div>

<div id="statistics" class="mt-4 p-5 d-none" style="background-color:#09223c;color:#ffd500;">
    <div class="row">
        <h2 id="total-shipments" class="col-md-6 text-center"></h2>
        <h2 id="total-rents" class="col-md-6 text-center"></h2>
    </div>
</div>

@section Scripts {
    <script>
        $('#statistics-button').on('click', function () {
            $.get('/api/statistics', function (data) {
                // Be tolerant to casing differences from the API
                const totalShipments =
                    data.totalShipments ??
                    data.totalExecutedShipments ??
                    data.TotalShipments ??
                    data.TotalExecutedShipments ?? 0;

                const totalRents =
                    data.totalRents ??
                    data.TotalRents ?? 0;

                $('#total-shipments').text(totalShipments + ' Shipments');
                $('#total-rents').text(totalRents + ' Rents');

                $('#statistics').removeClass('d-none');
                $('#statistics-button').hide();
            });
        });
    </script>
}
